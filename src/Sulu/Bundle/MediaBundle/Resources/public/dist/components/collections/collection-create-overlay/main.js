define(["services/sulumedia/collection-manager","services/husky/mediator"],function(a,b){"use strict";var c="sulu.collection-add.",d={parent:null,instanceName:""},e={newFormSelector:"#collection-new"},f=function(){return h.call(this,"closed")},g=function(){return h.call(this,"initialized")},h=function(a){return c+(this.options.instanceName?this.options.instanceName+".":"")+a};return{templates:["/admin/media/template/collection/new"],initialize:function(){this.options=this.sandbox.util.extend(!0,{},d,this.options),this.openOverlay(),this.sandbox.emit(g.call(this))},openOverlay:function(){var a=this.sandbox.dom.createElement('<div class="overlay-element"/>');this.sandbox.dom.append(this.$el,a),this.sandbox.once("husky.overlay.add-collection.opened",function(){this.sandbox.start(e.newFormSelector),this.sandbox.form.create(e.newFormSelector),$(e.newFormSelector+" input").first().focus()}.bind(this)),this.sandbox.start([{name:"overlay@husky",options:{el:a,title:this.sandbox.translate("sulu.media.add-collection"),instanceName:"add-collection",data:this.renderTemplate("/admin/media/template/collection/new"),okCallback:this.okCallback.bind(this),cancelCallback:function(){this.sandbox.stop()}.bind(this),openOnStart:!0,removeOnClose:!0,propagateEvents:!1}}])},okCallback:function(){return this.sandbox.form.validate(e.newFormSelector)?(this.addCollection(),void this.sandbox.stop()):!1},addCollection:function(){var c=this.sandbox.form.getData(e.newFormSelector);c.parent=this.options.parent,a.save(c).done(function(a){b.emit("sulu.media.collection-create.created",a)}.bind(this))},destroy:function(){this.sandbox.emit(f.call(this))}}});